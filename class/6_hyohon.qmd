---
title: 6 母集団と標本
---

# はじめに

-   社会調査や学術研究では，知りたい対象と手元のデータが必ずしも一致していません。そもそも，知りたい対象全体のデータを取るような調査はほとんど行われません。

    -   唯一の例外は国勢調査

-   例えば，世論調査は日本在住者の政治に対する意見などを知るためにデータを集めますが，全国民を対象としているわけではありません。

    -   全国民の意見を聞いていたら時間もお金もかかります。そもそも全員と連絡をつけることは非現実的です。

    -   そこで，例えば1,000人に聞いた意見から日本全体の世論を推測します。

-   例えば，新しい薬の効果を検証したい場合，知りたい対象は，過去・現在・未来に渡る特定の病気の患者への効果です。調査時点で過去の患者や未来の患者に対する効果を知ることはできません。

    -   そこで，治験対象者のデータから，人類一般に対する効果を推測します。

-   ここで，知りたい対象を**母集団**，検証に使う母集団の一部を**標本**と言います。

::: callout-note
特に経済学などでは，上記1つ目の例のように日本人全体，といった特定の母集団を想定しないことが多いとされます(星野ほか 2023; 高橋 2022)。その代わりに，サンプルを生み出す特定の確率分布を母集団と呼びます。
:::

-   確率論を基礎として，十分な数の適切に選ばれた標本を適切な方法で分析すると，非常に高い精度で母集団の傾向を推測できることが知られています。

-   ただし，「適切に標本を選ぶこと」「適切に分析すること」は現実にそう簡単ではなく，それゆえこの授業で扱う多変量解析を含め，多くの統計理論が研究され続けています。

まずは，理想的な状況における推測について扱います。

# 平均と分散（復習+α）

-   平均はデータの特徴を表す代表的な値の一つでした。変数 $X$ の平均 $\bar X$は，

$$ \bar X = (X_1 + X_2 + ... X_n )/n = \frac{1}{n} \Sigma_{i=1}^{n} X_i
$$

-   分散はデータのばらつきを表します。データは平均より高かったり低かったりするので，各データの平均からのずれ $(X_i - \bar X)$を2乗して

$$
\begin{split}
s_X^2 &= \frac{1}{n-1}\{(X_1 - \bar X)^2+(X_2 - \bar X)^2+(X_3 - \bar X)^2+...(X_n - \bar X)^2 \} \\ &= \frac{1}{n-1}\Sigma (X_i - \bar X)^2
\end{split}
$$

::: {.callout-caution appearance="simple" icon="false"}
前回と違って，$n-1$で割っています。前回のものを標本分散，今回のものを不偏分散と言います。標本を使って母集団の分散を推定する際には，不偏分散の方が良い（より正確になる）ためです。
:::

# 標本平均の性質

-   ある母集団から得た標本があります。母集団全体の平均（母平均）を $\mu$ とします。この $\mu$ は未知です。

-   ここで，標本観測と母平均との関係を以下のように想定します。

$$
X_i = \mu+u_i, u_i  \sim N(0,\sigma ^2)
$$

　ただし$u_1,u_2,u_3...u_n$は互いに独立(前の数字に後からでてくる数字が影響を受けない)

-   このとき，以下の性質が知られています。

$$E(\bar X) = \mu, Var(\bar X) = \frac{1}{n}\sigma^2$$

:   -   標本平均の期待値は，母平均となる

    -   サンプルサイズ(n)が大きくなるほど精度が高まる（ばらつきが小さく）

要するに...うまくサンプルをとることができれば，標本平均を使って母平均を推測できるということです。

逆に，うまくサンプルを取らなかったら当然ズレます

-   例：東京大学の学生の1,000人のTOEICの点数の平均を使って，日本国民の英語力を推定する。

後者，「サンプルサイズ(n)が大きくなるほど精度が高まる（ばらつきが小さく）」は，大数の法則として知られています。以下ではこの大数の法則を実際にシミュレーションで体感してもらいます。

大数の法則

:   母集団から無作為に抽出された標本の平均値は，標本の大きさが大きいほど，母集団平均に近い値を取る。

## 大数の法則のシミュレーション

サイコロには１から6までの目があり，それぞれが出る確率は1/6です。したがって，母集団の平均は，

$$
\frac{1}{6}\Sigma^6_{i=1}i=\frac{21}{6}=3.5
$$

サイコロを10回降った時

```{r}
s10 <- sample(1:6,10,replace = TRUE)
mean(s10)
```

1行目の `sample()`は，決められた数の標本を無作為に選び出す関数です。ここでは，1から6までの数を無作為に10個選び出しています。`replace`は復元抽出をするかしないかを指定するオプションです。「１から6までの数を無作為に10個復元抽出で選び取る」という命令をしていることになり，これを`s10`と名づけて保存しています。

2行目は，この`s10`の平均を計算しています。

同じように，1,000回サイコロを振ることを以下のように再現してみます。

```{r}
s1000 <- sample(1:6,1000,replace = TRUE)
mean(s1000)
```

（無作為抽出しているので，結果は個々人で違うと思いますが）おそらく10回の時よりも1,000回の時の方が期待値である3.5に近いはずです。

これをさらに以下のように検討してみます。

```{r}
#サイコロを10回振るのを1000回繰り返す
S <- 1000
rec10 <- numeric(S)
for(i in 1:S){
  rec10[i] <- sample(1:6, 10, replace = TRUE)|>
    mean()
}
summary(rec10)
```

-   1行目は，Sという名前で数字の1000を保存しています。
-   2行目は，`numeric`というコマンドで空（0）の行をSの数だけ作って，`rec10`と名付けています。
-   3行目は，1から6までの数字を無作為に10個（サイコロを10回振る）時の平均を計算して，`rec10`のi行目に入れる，という作業をS回(1000行分)繰り返しています。
-   4行目は，そうして作られた`rec10`の最小値，最大値，平均，中央値等を出しています。

```{r}
hist(rec10)
```

(毎回結果は変わりますが)この時最小値は1.8，最大値は5.3，平均は3.482でした。

これをサイコロを10000回振るのを1000回繰り返すのに変えてみます。

```{r}
#サイコロを10000回振るのを1000回繰り返す
S <- 1000
rec10000 <- numeric(S)
for(i in 1:S){
  rec10000[i] <- sample(1:6, 10000, replace = TRUE)|>
    mean()
}
summary(rec10000)
```

すると，最小値3.450，最大値3.553，平均値3.449と，3.5にかなり収束しました。

```{r}

#サイコロを100回振るのを1000回繰り返す
S <- 1000
rec100 <- numeric(S)
for(i in 1:S){
  rec100[i] <- sample(1:6, 100, replace = TRUE)|>
    mean()
}

#3つそれぞれヒストグラムを書いて，
#一つのシートに重ねて表示
hist(rec10000, 
     col="#FF00007F", 
     xlim=c(1.5,5),
     ann=F, 
     main="", 
     xlab="" ,
     breaks=seq(1,6,0.1)
     )
par(new=T)
hist(rec10, 
     breaks=seq(1,6,0.1),
     col="#0000FF7F",
     ann=F, 
     add=T)
hist(rec100, 
     breaks=seq(1,6,0.1),
     col="#32CD32",
     ann=F, 
     add=T)
legend("topright", 
       legend=c("rec10000", 
                "rec10", 
                "rec100"),
       fill=c("#FF00007F", 
              "#0000FF7F",
              "#32CD32")
       )


```

サンプルサイズ100のものも加えてヒストグラムを書きました。一回一回のサンプルサイズが大きいほど，母平均に近い値を取っていることが見えます。

# 標本分散の性質

標本分散や標準偏差についても大数の法則が成立します

### シミュレーション

```{r}
S <- 1000

srec10 <- numeric(S)
for(i in 1:S){
  srec10[i] <- sd(rnorm(10,50,10))
}

srec100 <- numeric(S)
for(i in 1:S){
  srec100[i] <- sd(rnorm(100,50,10))
}


srec10000 <- numeric(S)
for(i in 1:S){
  srec10000[i] <- sd(rnorm(10000,50,10))
}



hist(srec10000, col="#FF00007F", xlim=c(1,18),ann=F, main="", xlab="" ,breaks=seq(1,20,1))
par(new=T)
hist(srec10, breaks=seq(1,20,1),col="#0000FF7F",ann=F, add=T)

hist(srec100, breaks=seq(1,20,1),col="#32CD32",ann=F, add=T)
legend("topright", legend=c("rec10000", "rec10", "rec100"),fill=c("#FF00007F", "#0000FF7F","#32CD32"))

```

```{r}

```
